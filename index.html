<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>福皇播放器BETA</title>
    <script src="https://cdn.tailwindcss.com" async></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#1E40AF',
                        error: '#EF4444',
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .video-card-hover {
                @apply transition-all duration-300 hover:shadow-xl hover:-translate-y-1 will-change-transform cursor-pointer;
            }
            .play-overlay {
                @apply opacity-0 hover:opacity-100 transition-opacity duration-300;
            }
            .error-message {
                @apply absolute inset-0 bg-gray-100 dark:bg-gray-800 flex flex-col items-center justify-center p-2 text-center hidden;
            }
            .cover-error {
                @apply absolute inset-0 bg-gray-200 dark:bg-gray-700 flex flex-col items-center justify-center p-4 text-center hidden;
            }
            .grid-4x4 {
                @apply grid-cols-4;
            }
            .grid-1x16 {
                @apply grid-cols-1;
            }
            .grid-2x8 {
                @apply grid-cols-2;
            }
            .backdrop-blur {
                backdrop-filter: blur(8px);
            }
            .player-container {
                @apply bg-black rounded-xl overflow-hidden mb-8 shadow-xl transition-all duration-300;
            }
            .card-enter {
                @apply opacity-0 transform scale-95;
            }
            .card-enter-active {
                @apply opacity-100 transform scale-100 transition-all duration-500;
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-inter text-gray-800">
    <!-- 顶部重新加载按钮 -->
    <header class="sticky top-0 z-30 bg-white shadow-sm py-3 px-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-800">福皇播放器BETA</h1>
            <button id="top-retry-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors">
                <i class="fa fa-refresh mr-1"></i> 重新加载封面
            </button>
        </div>
    </header>

    <!-- 嵌入式视频播放器 -->
    <div class="container mx-auto px-4 py-6">
        <div id="video-player-container" class="player-container hidden">
            <!-- 视频头部控制区 -->
            <div class="flex justify-between items-center p-4 bg-gradient-to-b from-black/80 to-transparent text-white">
                <h2 id="player-title" class="text-xl font-semibold truncate max-w-[70%]"></h2>
                <button id="close-player" class="w-10 h-10 rounded-full bg-black/30 backdrop-blur flex items-center justify-center hover:bg-black/50 transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <!-- 视频播放区 -->
            <div class="relative">
                <!-- 视频播放错误提示 -->
                <div id="video-error" class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center text-white hidden">
                    <i class="fa fa-exclamation-circle text-error text-4xl mb-4"></i>
                    <p class="text-xl font-medium mb-2">视频播放失败</p>
                    <p id="video-error-message" class="text-gray-300 mb-6 text-center px-4">无法加载视频，请稍后重试</p>
                    <button id="retry-video" class="px-6 py-2 bg-primary hover:bg-secondary rounded-lg transition-colors">
                        <i class="fa fa-refresh mr-1"></i> 重试
                    </button>
                </div>
                
                <video id="video-player" class="w-full aspect-video object-contain" controls>
                    您的浏览器不支持HTML5视频播放
                </video>
                <div id="loading-indicator" class="hidden absolute inset-0 flex items-center justify-center bg-black/30">
                    <div class="w-16 h-16 border-4 border-primary/30 border-t-primary rounded-full animate-spin"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 视频列表 -->
    <div class="container mx-auto px-4 py-4">
        <div id="video-grid" class="grid gap-4">
            <!-- 视频卡片将通过JavaScript动态生成 -->
        </div>
        <!-- 全局加载状态指示器 -->
        <div id="global-loading" class="mt-8 text-center hidden">
            <p class="text-gray-600">
                <span id="loading-text">正在加载封面图片</span> 
                <span id="loading-progress">0</span>/<span id="total-items">0</span>
            </p>
            <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                <div id="loading-bar" class="bg-primary h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <script>
        // 缓存DOM元素和类名常量
        const DOM = {
            videoGrid: document.getElementById('video-grid'),
            videoContainer: document.getElementById('video-player-container'),
            videoPlayer: document.getElementById('video-player'),
            playerTitle: document.getElementById('player-title'),
            closePlayer: document.getElementById('close-player'),
            loadingIndicator: document.getElementById('loading-indicator'),
            globalLoading: document.getElementById('global-loading'),
            loadingProgress: document.getElementById('loading-progress'),
            totalItems: document.getElementById('total-items'),
            loadingBar: document.getElementById('loading-bar'),
            loadingText: document.getElementById('loading-text'),
            topRetryBtn: document.getElementById('top-retry-btn'),
            videoError: document.getElementById('video-error'),
            videoErrorMessage: document.getElementById('video-error-message'),
            retryVideo: document.getElementById('retry-video')
        };
        
        const CLASS = {
            hidden: 'hidden',
            videoCard: 'video-card-hover',
            coverLoading: 'cover-loading',
            coverError: 'cover-error',
            errorMessage: 'error-message',
            errorReason: 'error-reason',
            grid4x4: 'grid-4x4',
            grid1x16: 'grid-1x16',
            grid2x8: 'grid-2x8',
            cardEnter: 'card-enter',
            cardEnterActive: 'card-enter-active'
        };

        // 错误封面图片URL
        const ERROR_COVER_URL = "https://d.feiliupan.com/t/127891246667534336/ERROR.jpeg";

        // 视频数据
        const videos = [
            { id: 1, title: "空悲切", url: "https://d.feiliupan.com/t/127891246667534336/konbeiqie.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/konbeiqie.jpg" },
            { id: 2, title: "旧时的福家拳", url: "https://d.feiliupan.com/t/127891246667534336/Fujiaquan.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/fujiaquan.jpg" },
            { id: 3, title: "神经班", url: "https://d.feiliupan.com/t/127891246667534336/sjban.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/sjban.jpg" },
            { id: 4, title: "妖娆", url: "https://d.feiliupan.com/t/127891246667534336/yaorao.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/yaorao.jpg" },
            { id: 5, title: "缘分本就稀薄寡淡 多是清尘浊水后会无期", url: "https://d.feiliupan.com/t/127891246667534336/yuanfen.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/yuanfen.jpg" },
            { id: 6, title: "全场最佳", url: "https://d.feiliupan.com/t/127891246667534336/quanchangzuijia.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/quanchangzuijia.jpg" },
            { id: 7, title: "期待本就是很无力的东西", url: "https://d.feiliupan.com/t/127891246667534336/qiedaiwuli.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/qiedaiwuli.jpg" },
            { id: 8, title: "他还在", url: "https://d.feiliupan.com/t/127891246667534336/tahaizai.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/tahaizai.jpg" },
            { id: 9, title: "最特别的老师", url: "https://d.feiliupan.com/t/127891246667534336/tebiedeDog.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/tebiedeDog.jpg" },
            { id: 10, title: "他还是来了", url: "https://d.feiliupan.com/t/127891246667534336/tahaisilaile.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/tahaisilaile.jpg" },
            { id: 11, title: "肚子越大的人跑步越快", url: "https://d.feiliupan.com/t/127891246667534336/dudapaokuai.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/dudapaokuai.jpg" },
            { id: 12, title: "权威", url: "https://d.feiliupan.com/t/127891246667534336/quanwei.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/quanwei.jpg" },
            { id: 13, title: "福拳", url: "https://d.feiliupan.com/t/127891246667534336/fuquan.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/fuquan.jpg" },
            { id: 14, title: "我们都太年轻了，不知道福高肚大", url: "https://d.feiliupan.com/t/127891246667534336/womendoutainianqinle.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/womendoutainianqinle.jpg" },
            { id: 15, title: "福哥对不起", url: "https://d.feiliupan.com/t/127891246667534336/fuge520.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/fuge520.jpg" },
            { id: 16, title: "戒了烟我不习惯，没有你我怎么办", url: "https://d.feiliupan.com/t/127891246667534336/jieyan.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/jieyan.jpg" }
        ];

        // 当前播放的视频信息
        let currentVideo = null;
        
        // 存储所有图片元素引用和加载状态
        let allImages = [];
        let failedImages = [];
        let successfullyLoadedImages = [];
        let currentLoadIndex = 0;
        let totalProcessed = 0;
        const loadDelay = 300;

        // 根据屏幕比例确定布局
        function determineLayout() {
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const aspectRatio = windowWidth / windowHeight;
            
            if (aspectRatio > 1.65) {
                return { columns: 4, name: "4x4" };
            } else if (aspectRatio < 0.65) {
                return { columns: 1, name: "1x16" };
            } else {
                return { columns: 2, name: "2x8" };
            }
        }

        // 应用布局
        function applyLayout() {
            const layout = determineLayout();
            
            DOM.videoGrid.classList.remove(CLASS.grid4x4, CLASS.grid1x16, CLASS.grid2x8);
            
            if (layout.columns === 4) {
                DOM.videoGrid.classList.add(CLASS.grid4x4);
            } else if (layout.columns === 1) {
                DOM.videoGrid.classList.add(CLASS.grid1x16);
            } else {
                DOM.videoGrid.classList.add(CLASS.grid2x8);
            }
            
            adjustCardStyles(layout.columns);
        }

        // 调整卡片样式以适应不同布局
        function adjustCardStyles(columns) {
            document.querySelectorAll(`.${CLASS.videoCard}`).forEach(card => {
                card.classList.remove('p-2', 'p-3', 'p-4');
            });
            
            if (columns === 4) {
                DOM.videoGrid.classList.add('gap-4');
            } else if (columns === 1) {
                DOM.videoGrid.classList.add('gap-6');
                document.querySelectorAll(`.${CLASS.videoCard}`).forEach(card => {
                    card.classList.add('p-4');
                    const title = card.querySelector('h3');
                    title.classList.add('text-lg');
                });
            } else {
                DOM.videoGrid.classList.add('gap-6');
                document.querySelectorAll(`.${CLASS.videoCard}`).forEach(card => {
                    card.classList.add('p-3');
                });
            }
        }

        // 生成视频卡片 - 初始隐藏所有卡片
        function createVideoCards() {
            applyLayout();
            
            const fragment = document.createDocumentFragment();
            allImages = [];
            failedImages = [];
            successfullyLoadedImages = [];
            currentLoadIndex = 0;
            totalProcessed = 0;
            
            videos.forEach(video => {
                const card = document.createElement('div');
                // 初始状态隐藏，添加进入动画类
                card.className = `bg-white rounded-xl overflow-hidden shadow-lg ${CLASS.videoCard} transform transition-all ${CLASS.hidden} ${CLASS.cardEnter}`;
                card.dataset.videoId = video.id;
                card.innerHTML = `
                    <div class="relative aspect-video bg-gray-100 overflow-hidden">
                        <!-- 加载指示器 -->
                        <div class="${CLASS.coverLoading} absolute inset-0 flex items-center justify-center">
                            <div class="w-10 h-10 border-4 border-primary/30 border-t-primary rounded-full animate-spin"></div>
                        </div>
                        <!-- 封面图 - 初始使用错误封面 -->
                        <img class="video-cover w-full h-full object-cover" 
                             data-src="${video.cover}" 
                             src="${ERROR_COVER_URL}" 
                             alt="${video.title}">
                        <!-- 封面错误提示 -->
                        <div class="${CLASS.coverError}">
                            <i class="fa fa-exclamation-triangle text-error text-2xl mb-2"></i>
                            <p class="font-medium text-error">加载失败</p>
                            <p class="text-sm text-gray-600 mt-1">错误: <span class="error-code">-</span></p>
                        </div>
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                            <div class="w-14 h-14 rounded-full bg-primary/90 flex items-center justify-center transform hover:scale-110 transition-transform">
                                <i class="fa fa-play text-white text-xl ml-1"></i>
                            </div>
                        </div>
                    </div>
                    <div class="p-3">
                        <h3 class="font-medium line-clamp-2 text-gray-800">${video.title}</h3>
                    </div>
                `;
                
                const coverImg = card.querySelector('.video-cover');
                const loadingIndicator = card.querySelector(`.${CLASS.coverLoading}`);
                const errorDisplay = card.querySelector(`.${CLASS.coverError}`);
                const errorCodeDisplay = card.querySelector('.error-code');
                
                allImages.push({
                    card: card,
                    img: coverImg,
                    loading: loadingIndicator,
                    errorDisplay: errorDisplay,
                    errorCodeDisplay: errorCodeDisplay,
                    src: video.cover,
                    title: video.title,
                    loaded: false,
                    failed: false,
                    errorCode: null
                });
                
                fragment.appendChild(card);
            });
            
            DOM.videoGrid.appendChild(fragment);
            
            DOM.totalItems.textContent = allImages.length;
            DOM.globalLoading.classList.remove(CLASS.hidden);
            
            startSequentialLoading();
        }

        // 显示卡片并触发动画
        function showCard(card) {
            // 移除隐藏类
            card.classList.remove(CLASS.hidden);
            // 触发重排
            void card.offsetWidth;
            // 添加激活动画类
            card.classList.add(CLASS.cardEnterActive);
            
            // 动画结束后移除动画类
            setTimeout(() => {
                card.classList.remove(CLASS.cardEnter, CLASS.cardEnterActive);
            }, 500);
        }

        // 批量显示失败的卡片
        function showFailedCards() {
            failedImages.forEach(imgInfo => {
                showCard(imgInfo.card);
            });
        }

        // 开始有序加载图片
        function startSequentialLoading() {
            currentLoadIndex = 0;
            loadNextImage();
        }

        // 获取HTTP错误状态码
        function getHttpStatusCode(errorEvent) {
            if (errorEvent && errorEvent.target && errorEvent.target.src) {
                return new Promise((resolve) => {
                    const xhr = new XMLHttpRequest();
                    xhr.open('HEAD', errorEvent.target.src);
                    xhr.referrerPolicy = "no-referrer-when-downgrade";
                    
                    xhr.onload = () => {
                        resolve(xhr.status);
                    };
                    
                    xhr.onerror = () => {
                        resolve(null);
                    };
                    
                    xhr.send();
                });
            }
            return Promise.resolve(null);
        }

        // 加载下一张图片 - 成功则立即显示，失败则最后显示
        function loadNextImage() {
            if (currentLoadIndex >= allImages.length) {
                // 所有图片加载完成，显示失败的卡片
                showFailedCards();
                finishLoading();
                return;
            }
            
            updateLoadingProgress();
            
            const imageInfo = allImages[currentLoadIndex];
            
            // 创建临时图片对象用于预加载
            const tempImg = new Image();
            tempImg.referrerPolicy = "no-referrer-when-downgrade";
            
            tempImg.addEventListener('load', () => {
                // 预加载成功，更新实际图片
                imageInfo.img.src = imageInfo.src;
                imageInfo.loaded = true;
                imageInfo.failed = false;
                imageInfo.errorCode = null;
                
                // 隐藏加载指示器和错误显示
                imageInfo.loading.classList.add(CLASS.hidden);
                imageInfo.errorDisplay.classList.add(CLASS.hidden);
                
                // 添加到成功加载列表
                successfullyLoadedImages.push(imageInfo);
                
                // 立即显示成功加载的卡片
                showCard(imageInfo.card);
                
                currentLoadIndex++;
                totalProcessed++;
                setTimeout(loadNextImage, loadDelay);
            });
            
            tempImg.addEventListener('error', async (e) => {
                // 获取错误状态码
                const statusCode = await getHttpStatusCode(e);
                imageInfo.errorCode = statusCode || '未知';
                
                console.error(`封面加载失败 (${imageInfo.title}) 错误码: ${imageInfo.errorCode}`, imageInfo.src, e);
                
                imageInfo.loaded = false;
                imageInfo.failed = true;
                
                // 更新错误显示
                imageInfo.errorCodeDisplay.textContent = imageInfo.errorCode;
                imageInfo.loading.classList.add(CLASS.hidden);
                imageInfo.errorDisplay.classList.remove(CLASS.hidden);
                
                // 添加到失败列表，暂不显示
                failedImages.push(imageInfo);
                
                currentLoadIndex++;
                totalProcessed++;
                setTimeout(loadNextImage, loadDelay);
            });
            
            // 开始预加载
            tempImg.src = imageInfo.src;
        }

        // 完成加载流程
        function finishLoading() {
            // 隐藏全局加载指示器
            DOM.globalLoading.classList.add(CLASS.hidden);
        }

        // 重新加载图片 - 智能判断加载内容
        function reloadCovers() {
            // 隐藏所有卡片
            allImages.forEach(imgInfo => {
                imgInfo.card.classList.add(CLASS.hidden, CLASS.cardEnter);
                imgInfo.card.classList.remove(CLASS.cardEnterActive);
            });
            
            // 重置状态
            failedImages = [];
            successfullyLoadedImages = [];
            totalProcessed = 0;
            
            // 决定要重新加载的图片
            let imagesToReload;
            let loadingText;
            
            if (allImages.some(img => img.failed)) {
                // 有错误的封面，只重新加载错误的
                imagesToReload = allImages.filter(img => img.failed);
                loadingText = `正在重新加载错误的封面 (${imagesToReload.length}个)`;
            } else {
                // 没有错误，重新加载所有封面
                imagesToReload = [...allImages];
                loadingText = "正在重新加载所有封面";
            }
            
            // 重置要加载的图片状态
            imagesToReload.forEach(imgInfo => {
                imgInfo.loading.classList.remove(CLASS.hidden);
                imgInfo.errorDisplay.classList.add(CLASS.hidden);
                imgInfo.loaded = false;
                imgInfo.failed = false;
            });
            
            // 更新加载状态显示
            DOM.loadingText.textContent = loadingText;
            DOM.totalItems.textContent = imagesToReload.length;
            DOM.globalLoading.classList.remove(CLASS.hidden);
            
            // 依次重新加载
            let reloadIndex = 0;
            
            function reloadNext() {
                if (reloadIndex >= imagesToReload.length) {
                    // 显示所有失败的卡片
                    showFailedCards();
                    finishLoading();
                    return;
                }
                
                updateReloadProgress(reloadIndex, imagesToReload.length);
                
                const imgInfo = imagesToReload[reloadIndex];
                
                // 创建临时图片进行预加载
                const tempImg = new Image();
                tempImg.referrerPolicy = "no-referrer-when-downgrade";
                
                tempImg.addEventListener('load', () => {
                    // 预加载成功，更新实际图片
                    imgInfo.img.src = imgInfo.src;
                    imgInfo.loaded = true;
                    imgInfo.errorCode = null;
                    imgInfo.loading.classList.add(CLASS.hidden);
                    imgInfo.errorDisplay.classList.add(CLASS.hidden);
                    
                    // 添加到成功列表并显示
                    successfullyLoadedImages.push(imgInfo);
                    showCard(imgInfo.card);
                    
                    reloadIndex++;
                    totalProcessed++;
                    setTimeout(reloadNext, loadDelay);
                });
                
                tempImg.addEventListener('error', async (e) => {
                    // 获取错误状态码
                    const statusCode = await getHttpStatusCode(e);
                    imgInfo.errorCode = statusCode || '未知';
                    
                    console.error(`封面加载失败 (${imgInfo.title}) 错误码: ${imgInfo.errorCode}`, imgInfo.src, e);
                    
                    imgInfo.loaded = false;
                    imgInfo.failed = true;
                    failedImages.push(imgInfo);
                    imgInfo.loading.classList.add(CLASS.hidden);
                    imgInfo.errorCodeDisplay.textContent = imgInfo.errorCode;
                    imgInfo.errorDisplay.classList.remove(CLASS.hidden);
                    
                    reloadIndex++;
                    totalProcessed++;
                    setTimeout(reloadNext, loadDelay);
                });
                
                // 开始预加载
                tempImg.src = imgInfo.src;
            }
            
            // 开始重新加载第一张
            reloadNext();
        }

        // 更新重新加载进度显示
        function updateReloadProgress(current, total) {
            DOM.loadingProgress.textContent = current + 1;
            const percentage = ((current + 1) / total) * 100;
            DOM.loadingBar.style.width = `${percentage}%`;
        }

        // 更新加载进度
        function updateLoadingProgress() {
            DOM.loadingProgress.textContent = currentLoadIndex + 1;
            const percentage = ((currentLoadIndex + 1) / allImages.length) * 100;
            DOM.loadingBar.style.width = `${percentage}%`;
        }

        // 播放视频
        function playVideo(videoId) {
            const video = videos.find(v => v.id === videoId);
            if (!video) return;
            
            currentVideo = video;
            DOM.playerTitle.textContent = video.title;
            DOM.videoPlayer.src = video.url;
            DOM.videoContainer.classList.remove(CLASS.hidden);
            
            // 显示加载指示器
            DOM.loadingIndicator.classList.remove(CLASS.hidden);
            DOM.videoError.classList.add(CLASS.hidden);
            
            // 滚动到播放器
            DOM.videoContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // 尝试播放视频
            DOM.videoPlayer.load();
            const playPromise = DOM.videoPlayer.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    // 播放成功
                    DOM.loadingIndicator.classList.add(CLASS.hidden);
                }).catch(error => {
                    // 播放失败
                    console.error('视频播放失败:', error);
                    DOM.loadingIndicator.classList.add(CLASS.hidden);
                    DOM.videoError.classList.remove(CLASS.hidden);
                    DOM.videoErrorMessage.textContent = error.message || '无法加载视频，请稍后重试';
                });
            }
        }

        // 关闭视频播放器
        function closeVideoPlayer() {
            DOM.videoPlayer.pause();
            DOM.videoPlayer.src = '';
            DOM.videoContainer.classList.add(CLASS.hidden);
            currentVideo = null;
        }

        // 事件监听
        function setupEventListeners() {
            // 视频卡片点击事件
            DOM.videoGrid.addEventListener('click', (e) => {
                const card = e.target.closest(`.${CLASS.videoCard}`);
                if (card) {
                    const videoId = parseInt(card.dataset.videoId);
                    playVideo(videoId);
                }
            });
            
            // 关闭播放器
            DOM.closePlayer.addEventListener('click', closeVideoPlayer);
            
            // 视频播放错误处理
            DOM.videoPlayer.addEventListener('error', (e) => {
                console.error('视频播放错误:', e);
                DOM.loadingIndicator.classList.add(CLASS.hidden);
                DOM.videoError.classList.remove(CLASS.hidden);
                
                // 提供更具体的错误信息
                const errorMessages = {
                    1: '视频加载被中止',
                    2: '视频格式不支持',
                    3: '视频解码失败',
                    4: '视频无法加载',
                    5: '视频访问权限不足'
                };
                
                DOM.videoErrorMessage.textContent = errorMessages[e.target.error.code] || 
                    `视频播放错误 (代码: ${e.target.error.code})`;
            });
            
            // 视频可以播放时隐藏加载指示器
            DOM.videoPlayer.addEventListener('canplay', () => {
                DOM.loadingIndicator.classList.add(CLASS.hidden);
            });
            
            // 重试播放视频
            DOM.retryVideo.addEventListener('click', () => {
                if (currentVideo) {
                    DOM.videoError.classList.add(CLASS.hidden);
                    DOM.loadingIndicator.classList.remove(CLASS.hidden);
                    DOM.videoPlayer.src = currentVideo.url;
                    DOM.videoPlayer.load();
                    DOM.videoPlayer.play().catch(error => {
                        console.error('视频重试播放失败:', error);
                        DOM.loadingIndicator.classList.add(CLASS.hidden);
                        DOM.videoError.classList.remove(CLASS.hidden);
                        DOM.videoErrorMessage.textContent = error.message || '无法加载视频，请稍后重试';
                    });
                }
            });
            
            // 顶部重新加载封面按钮 - 智能决定重新加载内容
            DOM.topRetryBtn.addEventListener('click', () => {
                reloadCovers();
            });
            
            // 窗口大小变化时重新布局
            window.addEventListener('resize', applyLayout);
        }

        // 初始化
        function init() {
            createVideoCards();
            setupEventListeners();
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
    