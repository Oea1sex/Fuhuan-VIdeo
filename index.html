<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>福皇播放器BETA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class', // 启用类模式的深色模式
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#1E40AF',
                        error: '#EF4444',
                        dark: {
                            bg: '#121212',
                            card: '#1E1E1E',
                            text: '#E0E0E0',
                            textLight: '#AAAAAA'
                        }
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .video-card-hover {
                @apply transition-all duration-300 hover:shadow-xl hover:-translate-y-1 will-change-transform cursor-pointer;
            }
            .play-overlay {
                @apply opacity-0 hover:opacity-100 transition-opacity duration-300;
            }
            .error-message {
                @apply absolute inset-0 bg-gray-100 dark:bg-dark-bg flex flex-col items-center justify-center p-2 text-center hidden;
            }
            .cover-loading {
                @apply absolute inset-0 flex items-center justify-center;
            }
            .cover-error {
                @apply absolute inset-0 bg-gray-200 dark:bg-gray-800 flex flex-col items-center justify-center p-4 text-center hidden;
            }
            .grid-4x4 {
                @apply grid-cols-4;
            }
            .grid-1x16 {
                @apply grid-cols-1;
            }
            .grid-2x8 {
                @apply grid-cols-2;
            }
            .backdrop-blur {
                backdrop-filter: blur(8px);
            }
            .player-container {
                @apply bg-black rounded-xl overflow-hidden mb-8 shadow-xl transition-all duration-300;
            }
            .card-enter {
                @apply opacity-0 transform scale-95;
            }
            .card-enter-active {
                @apply opacity-100 transform scale-100 transition-all duration-500;
            }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-dark-bg font-inter text-gray-800 dark:text-dark-text transition-colors duration-300">
    <!-- 顶部导航 -->
    <header class="sticky top-0 z-30 bg-white dark:bg-dark-card shadow-sm py-3 px-4 transition-colors duration-300">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-800 dark:text-white">福皇播放器BETA</h1>
            <div class="flex items-center gap-3">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <i class="fa fa-moon-o text-gray-600 dark:text-gray-300"></i>
                </button>
                <button id="reload-covers" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors">
                    <i class="fa fa-refresh mr-1"></i> 重新加载封面
                </button>
            </div>
        </div>
    </header>

    <!-- 视频播放器 -->
    <div class="container mx-auto px-4 py-6">
        <div id="video-player-container" class="player-container hidden">
            <!-- 视频头部控制区 -->
            <div class="flex justify-between items-center p-4 bg-gradient-to-b from-black/80 to-transparent text-white">
                <h2 id="video-title" class="text-xl font-semibold truncate max-w-[70%]"></h2>
                <button id="close-player" class="w-10 h-10 rounded-full bg-black/30 backdrop-blur flex items-center justify-center hover:bg-black/50 transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <!-- 视频播放区 -->
            <div class="relative">
                <!-- 视频播放错误提示 -->
                <div id="video-error" class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center text-white hidden">
                    <i class="fa fa-exclamation-circle text-error text-4xl mb-4"></i>
                    <p class="text-xl font-medium mb-2">视频播放失败</p>
                    <p id="video-error-message" class="text-gray-300 mb-6 text-center px-4">无法加载视频，请稍后重试</p>
                    <button id="retry-video" class="px-6 py-2 bg-primary hover:bg-secondary rounded-lg transition-colors">
                        <i class="fa fa-refresh mr-1"></i> 重试
                    </button>
                </div>
                
                <video id="video-player" class="w-full aspect-video object-contain" controls=""></video>
                <div id="loading-indicator" class="hidden absolute inset-0 flex items-center justify-center bg-black/30">
                    <div class="w-16 h-16 border-4 border-primary/30 border-t-primary rounded-full animate-spin"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 视频列表 -->
    <div class="container mx-auto px-4 py-4">
        <div id="video-grid" class="grid gap-4"></div>
        
        <!-- 全局加载状态指示器 -->
        <div id="global-loading" class="mt-8 text-center hidden">
            <p class="text-gray-600 dark:text-gray-400">
                <span id="loading-text">正在加载封面图片</span> 
                <span id="loading-progress">0</span>/<span id="total-items">0</span>
            </p>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mt-2">
                <div id="loading-bar" class="bg-primary h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <script>
        // 应用主控制器
        const VideoPlayerApp = {
            // DOM元素缓存
            elements: {
                videoGrid: document.getElementById('video-grid'),
                videoContainer: document.getElementById('video-player-container'),
                videoPlayer: document.getElementById('video-player'),
                videoTitle: document.getElementById('video-title'),
                closePlayer: document.getElementById('close-player'),
                loadingIndicator: document.getElementById('loading-indicator'),
                globalLoading: document.getElementById('global-loading'),
                loadingProgress: document.getElementById('loading-progress'),
                totalItems: document.getElementById('total-items'),
                loadingBar: document.getElementById('loading-bar'),
                loadingText: document.getElementById('loading-text'),
                reloadCovers: document.getElementById('reload-covers'),
                videoError: document.getElementById('video-error'),
                videoErrorMessage: document.getElementById('video-error-message'),
                retryVideo: document.getElementById('retry-video'),
                themeToggle: document.getElementById('theme-toggle'),
                themeIcon: document.querySelector('#theme-toggle i')
            },
            
            // 样式类名常量
            classes: {
                hidden: 'hidden',
                videoCard: 'video-card-hover',
                coverLoading: 'cover-loading',
                coverError: 'cover-error',
                grid4x4: 'grid-4x4',
                grid1x16: 'grid-1x16',
                grid2x8: 'grid-2x8',
                cardEnter: 'card-enter',
                cardEnterActive: 'card-enter-active'
            },
            
            // 配置常量
            config: {
                errorCoverUrl: "https://d.feiliupan.com/t/127891246667534336/ERROR.jpeg",
                loadDelay: 300,
                videoLoadTimeout: 15000 // 视频加载超时时间(毫秒)
            },
            
            // 应用状态
            state: {
                videos: [
                    { id: 1, title: "空悲切", url: "https://d.feiliupan.com/t/127891246667534336/konbeiqie.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/konbeiqie.jpg" },
                    { id: 2, title: "旧时的福家拳", url: "https://d.feiliupan.com/t/127891246667534336/Fujiaquan.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/fujiaquan.jpg" },
                    { id: 3, title: "神经班", url: "https://d.feiliupan.com/t/127891246667534336/sjban.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/sjban.jpg" },
                    { id: 4, title: "妖娆", url: "https://d.feiliupan.com/t/127891246667534336/yaorao.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/yaorao.jpg" },
                    { id: 5, title: "缘分本就稀薄寡淡 多是清尘浊水后会无期", url: "https://d.feiliupan.com/t/127891246667534336/yuanfen.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/yuanfen.jpg" },
                    { id: 6, title: "全场最佳", url: "https://d.feiliupan.com/t/127891246667534336/quanchangzuijia.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/quanchangzuijia.jpg" },
                    { id: 7, title: "期待本就是很无力的东西", url: "https://d.feiliupan.com/t/127891246667534336/qiedaiwuli.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/qiedaiwuli.jpg" },
                    { id: 8, title: "他还在", url: "https://d.feiliupan.com/t/127891246667534336/tahaizai.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/tahaizai.jpg" },
                    { id: 9, title: "最特别的老师", url: "https://d.feiliupan.com/t/127891246667534336/tebiedeDog.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/tebiedeDog.jpg" },
                    { id: 10, title: "他还是来了", url: "https://d.feiliupan.com/t/127891246667534336/tahaisilaile.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/tahaisilaile.jpg" },
                    { id: 11, title: "肚子越大的人跑步越快", url: "https://d.feiliupan.com/t/127891246667534336/dudapaokuai.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/dudapaokuai.jpg" },
                    { id: 12, title: "权威", url: "https://d.feiliupan.com/t/127891246667534336/quanwei.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/quanwei.jpg" },
                    { id: 13, title: "福拳", url: "https://d.feiliupan.com/t/127891246667534336/fuquan.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/fuquan.jpg" },
                    { id: 14, title: "我们都太年轻了，不知道福高肚大", url: "https://d.feiliupan.com/t/127891246667534336/womendoutainianqinle.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/womendoutainianqinle.jpg" },
                    { id: 15, title: "福哥对不起", url: "https://d.feiliupan.com/t/127891246667534336/fuge520.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/fuge520.jpg" },
                    { id: 16, title: "戒了烟我不习惯，没有你我怎么办", url: "https://d.feiliupan.com/t/127891246667534336/jieyan.mp4", cover: "https://d.feiliupan.com/t/127891246667534336/jieyan.jpg" }
                ],
                currentVideo: null,
                allImages: [],
                failedImages: [],
                sortedSuccessImages: [],
                currentLoadIndex: 0,
                totalProcessed: 0,
                loadTimeout: null // 视频加载超时计时器
            },
            
            // 初始化应用
            init() {
                this.setupEventListeners();
                this.createVideoCards();
                this.initializeTheme(); // 初始化主题
            },
            
            // 设置事件监听器
            setupEventListeners() {
                // 视频卡片点击事件
                this.elements.videoGrid.addEventListener('click', (e) => {
                    const card = e.target.closest(`.${this.classes.videoCard}`);
                    if (card) {
                        const videoId = parseInt(card.dataset.videoId);
                        this.playVideo(videoId);
                    }
                });
                
                // 关闭播放器
                this.elements.closePlayer.addEventListener('click', () => this.closeVideoPlayer());
                
                // 视频播放错误处理
                this.elements.videoPlayer.addEventListener('error', (e) => this.handleVideoError(e));
                
                // 视频可以播放时隐藏加载指示器
                this.elements.videoPlayer.addEventListener('canplay', () => this.hideLoadingIndicator());
                
                // 视频数据加载完成时隐藏加载指示器
                this.elements.videoPlayer.addEventListener('loadeddata', () => this.hideLoadingIndicator());
                
                // 视频开始播放时隐藏加载指示器
                this.elements.videoPlayer.addEventListener('play', () => this.hideLoadingIndicator());
                
                // 视频缓冲时显示加载指示器
                this.elements.videoPlayer.addEventListener('waiting', () => {
                    // 只有在没有错误的情况下才显示加载指示器
                    if (this.elements.videoError.classList.contains(this.classes.hidden)) {
                        this.showLoadingIndicator();
                    }
                });
                
                // 视频暂停时也确保隐藏加载指示器
                this.elements.videoPlayer.addEventListener('pause', () => this.hideLoadingIndicator());
                
                // 视频结束时确保隐藏加载指示器
                this.elements.videoPlayer.addEventListener('ended', () => this.hideLoadingIndicator());
                
                // 重试播放视频
                this.elements.retryVideo.addEventListener('click', () => this.retryVideoPlayback());
                
                // 重新加载封面按钮
                this.elements.reloadCovers.addEventListener('click', () => this.reloadAllCovers());
                
                // 窗口大小变化时重新布局
                window.addEventListener('resize', () => this.applyLayout());
                
                // 主题切换
                this.elements.themeToggle.addEventListener('click', () => this.toggleTheme());
            },
            
            // 显示加载指示器
            showLoadingIndicator() {
                this.elements.loadingIndicator.classList.remove(this.classes.hidden);
            },
            
            // 隐藏加载指示器 - 强制移除加载状态
            hideLoadingIndicator() {
                // 强制添加hidden类，确保完全隐藏
                this.elements.loadingIndicator.classList.add(this.classes.hidden);
                
                // 清除超时计时器
                if (this.state.loadTimeout) {
                    clearTimeout(this.state.loadTimeout);
                    this.state.loadTimeout = null;
                }
            },
            
            // 根据屏幕比例确定布局
            determineLayout() {
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                const aspectRatio = windowWidth / windowHeight;
                
                if (aspectRatio > 1.65) {
                    return { columns: 4, name: "4x4" };
                } else if (aspectRatio < 0.65) {
                    return { columns: 1, name: "1x16" };
                } else {
                    return { columns: 2, name: "2x8" };
                }
            },
            
            // 应用布局
            applyLayout() {
                const layout = this.determineLayout();
                const grid = this.elements.videoGrid;
                
                // 移除所有布局类
                grid.classList.remove(this.classes.grid4x4, this.classes.grid1x16, this.classes.grid2x8);
                
                // 添加当前布局类
                if (layout.columns === 4) {
                    grid.classList.add(this.classes.grid4x4);
                } else if (layout.columns === 1) {
                    grid.classList.add(this.classes.grid1x16);
                } else {
                    grid.classList.add(this.classes.grid2x8);
                }
                
                this.adjustCardStyles(layout.columns);
            },
            
            // 调整卡片样式以适应不同布局
            adjustCardStyles(columns) {
                const cards = document.querySelectorAll(`.${this.classes.videoCard}`);
                
                // 重置卡片内边距
                cards.forEach(card => {
                    card.classList.remove('p-2', 'p-3', 'p-4');
                    const title = card.querySelector('h3');
                    title?.classList.remove('text-lg');
                });
                
                // 设置网格间距
                this.elements.videoGrid.classList.remove('gap-4', 'gap-6');
                
                if (columns === 4) {
                    this.elements.videoGrid.classList.add('gap-4');
                } else if (columns === 1) {
                    this.elements.videoGrid.classList.add('gap-6');
                    cards.forEach(card => {
                        card.classList.add('p-4');
                        const title = card.querySelector('h3');
                        title?.classList.add('text-lg');
                    });
                } else {
                    this.elements.videoGrid.classList.add('gap-6');
                    cards.forEach(card => card.classList.add('p-3'));
                }
            },
            
            // 创建视频卡片
            createVideoCards() {
                this.applyLayout();
                
                // 重置状态
                this.state.allImages = [];
                this.state.failedImages = [];
                this.state.sortedSuccessImages = [];
                this.state.currentLoadIndex = 0;
                this.state.totalProcessed = 0;
                
                // 清空网格
                this.elements.videoGrid.innerHTML = '';
                
                const fragment = document.createDocumentFragment();
                
                // 创建所有视频卡片
                this.state.videos.forEach(video => {
                    const card = this.createVideoCard(video);
                    this.state.allImages.push(this.createImageInfo(card, video));
                    fragment.appendChild(card);
                });
                
                this.elements.videoGrid.appendChild(fragment);
                
                // 更新加载状态显示
                this.elements.totalItems.textContent = this.state.allImages.length;
                this.elements.globalLoading.classList.remove(this.classes.hidden);
                
                // 开始随机加载封面
                this.startRandomLoading();
            },
            
            // 创建单个视频卡片
            createVideoCard(video) {
                const card = document.createElement('div');
                card.className = `bg-white dark:bg-dark-card rounded-xl overflow-hidden shadow-lg ${this.classes.videoCard} transform transition-all ${this.classes.hidden} ${this.classes.cardEnter}`;
                card.dataset.videoId = video.id;
                
                card.innerHTML = `
                    <div class="relative aspect-video bg-gray-100 dark:bg-gray-800 overflow-hidden">
                        <!-- 加载指示器 -->
                        <div class="${this.classes.coverLoading}">
                            <div class="w-10 h-10 border-4 border-primary/30 border-t-primary rounded-full animate-spin"></div>
                        </div>
                        <!-- 封面图 - 初始使用错误封面 -->
                        <img class="video-cover w-full h-full object-cover" 
                             data-src="${video.cover}" 
                             src="${this.config.errorCoverUrl}" 
                             alt="${video.title}">
                        <!-- 封面错误提示 -->
                        <div class="${this.classes.coverError}">
                            <i class="fa fa-exclamation-triangle text-error text-2xl mb-2"></i>
                            <p class="font-medium text-error">加载失败</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">错误: <span class="error-code">-</span></p>
                        </div>
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                            <div class="w-14 h-14 rounded-full bg-primary/90 flex items-center justify-center transform hover:scale-110 transition-transform">
                                <i class="fa fa-play text-white text-xl ml-1"></i>
                            </div>
                        </div>
                    </div>
                    <div class="p-3">
                        <h3 class="font-medium line-clamp-2 text-gray-800 dark:text-dark-text">${video.title}</h3>
                    </div>
                `;
                
                return card;
            },
            
            // 创建图片信息对象
            createImageInfo(card, video) {
                return {
                    card,
                    img: card.querySelector('.video-cover'),
                    loading: card.querySelector(`.${this.classes.coverLoading}`),
                    errorDisplay: card.querySelector(`.${this.classes.coverError}`),
                    errorCodeDisplay: card.querySelector('.error-code'),
                    src: video.cover,
                    title: video.title,
                    loaded: false,
                    failed: false,
                    errorCode: null
                };
            },
            
            // 显示卡片并触发动画
            showCard(card) {
                // 移除隐藏类
                card.classList.remove(this.classes.hidden);
                // 触发重排
                void card.offsetWidth;
                // 添加激活动画类
                card.classList.add(this.classes.cardEnterActive);
                
                // 动画结束后移除动画类
                setTimeout(() => {
                    card.classList.remove(this.classes.cardEnter, this.classes.cardEnterActive);
                }, 500);
            },
            
            // 显示失败的卡片
            showFailedCards() {
                this.state.failedImages.forEach(imgInfo => {
                    this.showCard(imgInfo.card);
                });
            },
            
            // 打乱数组顺序
            shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            },
            
            // 开始随机加载图片
            startRandomLoading() {
                // 创建随机排序的索引数组
                const randomIndices = this.shuffleArray(
                    Array.from({ length: this.state.allImages.length }, (_, i) => i)
                );
                
                // 递归加载下一张图片
                const loadNextImage = () => {
                    if (this.state.currentLoadIndex >= randomIndices.length) {
                        // 所有图片加载完成，显示失败的卡片
                        this.showFailedCards();
                        this.finishLoading();
                        return;
                    }
                    
                    this.updateLoadingProgress();
                    
                    const index = randomIndices[this.state.currentLoadIndex];
                    const imageInfo = this.state.allImages[index];
                    
                    // 创建临时图片对象用于预加载
                    const tempImg = new Image();
                    tempImg.referrerPolicy = "no-referrer-when-downgrade";
                    
                    tempImg.addEventListener('load', () => this.handleImageLoad(imageInfo, loadNextImage));
                    tempImg.addEventListener('error', (e) => this.handleImageError(imageInfo, e, loadNextImage));
                    
                    // 开始预加载
                    tempImg.src = imageInfo.src;
                };
                
                // 开始加载第一张图片
                loadNextImage();
            },
            
            // 处理图片加载成功
            handleImageLoad(imageInfo, nextCallback) {
                // 更新图片信息状态
                imageInfo.img.src = imageInfo.src;
                imageInfo.loaded = true;
                imageInfo.failed = false;
                imageInfo.errorCode = null;
                
                // 隐藏加载指示器和错误显示
                imageInfo.loading.classList.add(this.classes.hidden);
                imageInfo.errorDisplay.classList.add(this.classes.hidden);
                
                // 添加到成功加载列表
                this.state.sortedSuccessImages.push(imageInfo);
                
                // 重新排序网格
                this.reorderVideoGrid();
                
                // 显示当前卡片
                this.showCard(imageInfo.card);
                
                // 继续加载下一张
                this.state.currentLoadIndex++;
                this.state.totalProcessed++;
                setTimeout(nextCallback, this.config.loadDelay);
            },
            
            // 处理图片加载错误
            handleImageError(imageInfo, errorEvent, nextCallback) {
                // 获取错误状态码
                this.getHttpStatusCode(errorEvent).then(statusCode => {
                    imageInfo.errorCode = statusCode || '未知';
                    console.error(`封面加载失败 (${imageInfo.title}) 错误码: ${imageInfo.errorCode}`, imageInfo.src);
                    
                    // 更新图片信息状态
                    imageInfo.loaded = false;
                    imageInfo.failed = true;
                    
                    // 更新错误显示
                    imageInfo.errorCodeDisplay.textContent = imageInfo.errorCode;
                    imageInfo.loading.classList.add(this.classes.hidden);
                    imageInfo.errorDisplay.classList.remove(this.classes.hidden);
                    
                    // 添加到失败列表
                    this.state.failedImages.push(imageInfo);
                    
                    // 继续加载下一张
                    this.state.currentLoadIndex++;
                    this.state.totalProcessed++;
                    setTimeout(nextCallback, this.config.loadDelay);
                });
            },
            
            // 获取HTTP错误状态码
            getHttpStatusCode(errorEvent) {
                if (errorEvent && errorEvent.target && errorEvent.target.src) {
                    return new Promise((resolve) => {
                        const xhr = new XMLHttpRequest();
                        xhr.open('HEAD', errorEvent.target.src);
                        xhr.referrerPolicy = "no-referrer-when-downgrade";
                        
                        xhr.onload = () => resolve(xhr.status);
                        xhr.onerror = () => resolve(null);
                        
                        xhr.send();
                    });
                }
                return Promise.resolve(null);
            },
            
            // 重新排序视频网格
            reorderVideoGrid() {
                // 先移除所有卡片但不删除它们
                const cards = Array.from(this.elements.videoGrid.children);
                cards.forEach(card => this.elements.videoGrid.removeChild(card));
                
                // 先添加按顺序加载成功的卡片
                this.state.sortedSuccessImages.forEach(imgInfo => {
                    this.elements.videoGrid.appendChild(imgInfo.card);
                });
                
                // 再添加尚未加载完成的卡片（保持隐藏状态）
                this.state.allImages.forEach(imgInfo => {
                    if (!imgInfo.loaded && !imgInfo.failed && 
                        !this.state.sortedSuccessImages.includes(imgInfo)) {
                        this.elements.videoGrid.appendChild(imgInfo.card);
                    }
                });
                
                // 最后添加加载失败的卡片（保持隐藏状态）
                this.state.failedImages.forEach(imgInfo => {
                    if (!this.elements.videoGrid.contains(imgInfo.card)) {
                        this.elements.videoGrid.appendChild(imgInfo.card);
                    }
                });
            },
            
            // 更新加载进度
            updateLoadingProgress() {
                this.elements.loadingProgress.textContent = this.state.currentLoadIndex + 1;
                const percentage = ((this.state.currentLoadIndex + 1) / this.state.allImages.length) * 100;
                this.elements.loadingBar.style.width = `${percentage}%`;
            },
            
            // 完成加载流程
            finishLoading() {
                this.elements.globalLoading.classList.add(this.classes.hidden);
            },
            
            // 播放视频
            playVideo(videoId) {
                const video = this.state.videos.find(v => v.id === videoId);
                if (!video) return;
                
                this.state.currentVideo = video;
                this.elements.videoTitle.textContent = video.title;
                this.elements.videoPlayer.src = video.url;
                this.elements.videoContainer.classList.remove(this.classes.hidden);
                
                // 显示加载指示器
                this.showLoadingIndicator();
                this.elements.videoError.classList.add(this.classes.hidden);
                
                // 滚动到播放器
                this.elements.videoContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // 设置加载超时
                this.state.loadTimeout = setTimeout(() => {
                    if (!this.elements.loadingIndicator.classList.contains(this.classes.hidden)) {
                        this.hideLoadingIndicator();
                        this.elements.videoError.classList.remove(this.classes.hidden);
                        this.elements.videoErrorMessage.textContent = '视频加载超时，请重试';
                    }
                }, this.config.videoLoadTimeout);
                
                // 尝试播放视频
                this.elements.videoPlayer.load();
                this.elements.videoPlayer.play().catch(error => {
                    console.error('视频播放失败:', error);
                    this.hideLoadingIndicator();
                    this.elements.videoError.classList.remove(this.classes.hidden);
                    this.elements.videoErrorMessage.textContent = error.message || '无法加载视频，请稍后重试';
                });
            },
            
            // 关闭视频播放器
            closeVideoPlayer() {
                this.elements.videoPlayer.pause();
                this.elements.videoPlayer.src = '';
                this.elements.videoContainer.classList.add(this.classes.hidden);
                this.state.currentVideo = null;
                this.hideLoadingIndicator();
            },
            
            // 处理视频播放错误
            handleVideoError(event) {
                console.error('视频播放错误:', event);
                this.hideLoadingIndicator();
                this.elements.videoError.classList.remove(this.classes.hidden);
                
                // 提供更具体的错误信息
                const errorMessages = {
                    1: '视频加载被中止',
                    2: '视频格式不支持',
                    3: '视频解码失败',
                    4: '视频无法加载',
                    5: '视频访问权限不足'
                };
                
                this.elements.videoErrorMessage.textContent = errorMessages[event.target.error.code] || 
                    `视频播放错误 (代码: ${event.target.error.code})`;
            },
            
            // 重试视频播放
            retryVideoPlayback() {
                if (this.state.currentVideo) {
                    this.elements.videoError.classList.add(this.classes.hidden);
                    this.showLoadingIndicator();
                    
                    // 重置超时计时器
                    if (this.state.loadTimeout) {
                        clearTimeout(this.state.loadTimeout);
                    }
                    
                    this.state.loadTimeout = setTimeout(() => {
                        if (!this.elements.loadingIndicator.classList.contains(this.classes.hidden)) {
                            this.hideLoadingIndicator();
                            this.elements.videoError.classList.remove(this.classes.hidden);
                            this.elements.videoErrorMessage.textContent = '视频加载超时，请重试';
                        }
                    }, this.config.videoLoadTimeout);
                    
                    this.elements.videoPlayer.src = this.state.currentVideo.url;
                    this.elements.videoPlayer.load();
                    this.elements.videoPlayer.play().catch(error => {
                        console.error('视频重试播放失败:', error);
                        this.hideLoadingIndicator();
                        this.elements.videoError.classList.remove(this.classes.hidden);
                        this.elements.videoErrorMessage.textContent = error.message || '无法加载视频，请稍后重试';
                    });
                }
            },
            
            // 重新加载所有封面
            reloadAllCovers() {
                this.createVideoCards();
            },
            
            // 初始化主题
            initializeTheme() {
                // 检查本地存储的主题偏好
                const savedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                    document.documentElement.classList.add('dark');
                    this.updateThemeIcon(true);
                } else {
                    document.documentElement.classList.remove('dark');
                    this.updateThemeIcon(false);
                }
            },
            
            // 切换主题
            toggleTheme() {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                this.updateThemeIcon(isDark);
            },
            
            // 更新主题图标
            updateThemeIcon(isDark) {
                const icon = this.elements.themeIcon;
                if (isDark) {
                    icon.classList.remove('fa-moon-o');
                    icon.classList.add('fa-sun-o');
                } else {
                    icon.classList.remove('fa-sun-o');
                    icon.classList.add('fa-moon-o');
                }
            }
        };

        // 页面加载完成后初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            VideoPlayerApp.init();
        });
    </script>


</body></html>